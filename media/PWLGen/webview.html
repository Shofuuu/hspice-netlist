<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${webview.cspSource} 'unsafe-inline'; script-src ${webview.cspSource} 'unsafe-inline';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSPICE PWL Designer</title>
    <link rel="stylesheet" type="text/css" href="{{styleUri}}">
</head>
<body>

<div class="toolbar">
    <div class="toolbar-group">
        <label>Name</label>
        <input type="text" id="sigName" value="vin" style="width:70px" placeholder="Signal...">
    </div>
    <div class="toolbar-separator"></div>
    <div class="toolbar-group">
        <label>Max T</label>
        <input type="number" id="maxTime" value="100" style="width:55px">
        <select id="timeUnit">
            <option value="1e-12">ps</option>
            <option value="1e-9">ns</option>
            <option value="1e-6" selected>us</option>
            <option value="1e-3">ms</option>
            <option value="1">s</option>
        </select>
    </div>
    <div class="toolbar-separator"></div>
    <div class="toolbar-group">
        <label>Max V</label>
        <input type="number" id="maxVolts" value="3.3" style="width:55px">
        <select id="voltUnit">
            <option value="1e-3">mV</option>
            <option value="1" selected>V</option>
            <!-- <option value="1e3">kV</option> -->
        </select>
    </div>
    <div style="flex-grow:1"></div>
    <button id="resetBtn" class="icon-btn" title="Clear All / Reset" style="color: #ff6b6b;">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
            <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
        </svg>
    </button>

    <button id="fitBtn" class="icon-btn" title="Fit View to Waveform">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M1.5 0A1.5 1.5 0 0 0 0 1.5v9A1.5 1.5 0 0 0 1.5 12h4a.5.5 0 0 0 0-1h-4a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-4a.5.5 0 0 0 0 1h4A1.5 1.5 0 0 0 16 10.5v-9A1.5 1.5 0 0 0 14.5 0h-13z"/>
            <path d="M4.5 4a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 0-1H5v-2.5A.5.5 0 0 0 4.5 4zm7 0a.5.5 0 0 0-.5.5v2.5H8.5a.5.5 0 0 0 0 1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5z"/>
        </svg>
    </button>
</div>

<div class="canvas-container" id="container">
    <canvas id="canvas"></canvas>
</div>

<div id="context-menu">
    <div class="menu-item" id="menu-add">Add Point Here</div>
    <div class="menu-item" id="menu-snap">Snap to Nearest Y</div>
    <div class="menu-item" id="menu-grid">Change Grid Size...</div>
    <div class="menu-item" id="menu-slope">Slope Settings...</div>
    <div class="menu-item" id="menu-delete">Delete Point</div>
    <div class="menu-separator"></div>
    <div class="menu-item has-submenu">
        Generate <span class="arrow">â–¶</span>
        <div class="submenu">
            <div class="menu-item" id="gen-square">Square Wave</div>
            <div class="menu-item" id="gen-tri">Triangle Wave</div>
            <div class="menu-item" id="gen-saw">Sawtooth Wave</div>
        </div>
    </div>
</div>

<div id="modal-overlay" class="modal-overlay">
    <div class="modal">
        <h3 id="modal-title">Generate Wave</h3>
        <div class="form-row">
            <label>V High (v) <i class="info-icon" data-tooltip="Peak voltage">i</i></label>
            <input type="number" id="gen-vhigh" value="3.3">
        </div>
        <div class="form-row">
            <label>V Low (v) <i class="info-icon" data-tooltip="Valley voltage">i</i></label>
            <input type="number" id="gen-vlow" value="0">
        </div>
        <div class="form-row">
            <label>Delay (<span id="gen-unit-delay">ns</span>)</label> 
            <input type="number" id="gen-delay" value="0">
        </div>
        <div class="form-row">
            <label>Period (<span id="gen-unit-period">ns</span>) <i class="info-icon" data-tooltip="One cycle duration">i</i></label>
            <input type="number" id="gen-period" value="20">
        </div>
        <div class="form-row">
            <label>Freq (MHz)</label>
            <input type="number" id="gen-freq" value="50">
        </div>
        <div class="form-row">
            <label>Duty (%) <i class="info-icon" data-tooltip="% before falling edge">i</i></label>
            <input type="number" id="gen-duty" value="50">
        </div>
        <div class="form-row">
            <label>Rise (<span id="gen-unit-tr">ns</span>)</label>
            <input type="number" id="gen-tr" value="0.1" step="0.1">
        </div>
        <div class="form-row">
            <label>Fall (<span id="gen-unit-tf">ns</span>)</label>
            <input type="number" id="gen-tf" value="0.1" step="0.1">
        </div>
        <div class="form-row">
            <label>Cycles <i class="info-icon" data-tooltip="How much cycle do you want">i</i></label>
            <input type="number" id="gen-cycles" value="5">
        </div>
        <div class="modal-buttons">
            <button class="btn-cancel" id="gen-cancel">Cancel</button>
            <button id="gen-confirm">Generate</button>
        </div>
    </div>
</div>

<div id="modal-grid-overlay" class="modal-overlay">
    <div class="modal modal-sm"> <h3>Grid Settings</h3>
        <p style="font-size: 11px; opacity:0.7; margin-bottom: 15px;">Set grid spacing. 0 = Auto.</p>
        
        <div class="form-row">
            <label>X (<span id="lbl-grid-x-unit">ns</span>)</label> 
            <input type="number" id="grid-x" step="any">
        </div>
        <div class="form-row">
            <label>Y (<span id="lbl-grid-y-unit">V</span>)</label> 
            <input type="number" id="grid-y" step="any">
        </div>
        
        <div class="modal-buttons">
            <button class="btn-cancel" id="grid-cancel">Cancel</button>
            <button id="grid-confirm">Apply</button>
        </div>
    </div>
</div>

<div class="footer">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <span style="font-size:11px; opacity:0.7">Left Drag: Move | Right Click: Menu | <b>Snap Enabled</b></span>
        
        <button id="copyBtn" class="icon-btn" title="Copy to Clipboard">
            <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                <path d="M4 4l1-1h5.414L14 6.586V14l-1 1H5l-1-1V4zm9 3l-3-3H5v10h8V7z"/>
                <path d="M3 1L2 2v10l1 1V2h6.414l-1-1H3z"/>
            </svg>
        </button>
    </div>
    <div class="output-box" id="codeOutput">...</div>
</div>

<div id="modal-slope-overlay" class="modal-overlay">
    <div class="modal modal-sm">
        <h3>Slope Settings</h3>
        <div class="form-row">
            <label>Unit</label>
            <select id="slope-unit">
                <option value="1e-12">ps</option>
                <option value="1e-9" selected>ns</option>
                <option value="1e-6">us</option>
                <option value="1e-3">ms</option>
                <option value="1">s</option>
            </select>
        </div>
        <div class="form-row">
            <label>Rise Time</label> 
            <input type="number" id="slope-tr" value="25">
        </div>
        <div class="form-row">
            <label>Fall Time</label> 
            <input type="number" id="slope-tf" value="25">
        </div>
        <div class="modal-buttons">
            <button class="btn-cancel" id="slope-cancel">Cancel</button>
            <button id="slope-confirm">Apply</button>
        </div>
    </div>
</div>

<script type="module" src="{{scriptUri}}"></script>
</body>
</html>