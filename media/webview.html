<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${webview.cspSource} 'unsafe-inline'; script-src ${webview.cspSource} 'unsafe-inline';">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSPICE PWL Designer</title>
    
    <link rel="stylesheet" type="text/css" href="{{styleUri}}">
</head>
<body>

<div class="toolbar">
    <div class="toolbar-group">
        <label>Name</label>
        <input type="text" id="sigName" value="vin" style="width:70px" placeholder="Signal...">
    </div>

    <div class="toolbar-separator"></div>

    <div class="toolbar-group">
        <label>Max T</label>
        <input type="number" id="maxTime" value="100" style="width:55px">
        <select id="timeUnit">
            <option value="1e-12">ps</option>
            <option value="1e-9" selected>ns</option>
            <option value="1e-6">us</option>
            <option value="1e-3">ms</option>
            <option value="1">s</option>
        </select>
    </div>

    <div class="toolbar-separator"></div>

    <div class="toolbar-group">
        <label>Max V</label>
        <input type="number" id="maxVolts" value="3.3" style="width:55px">
        <select id="voltUnit">
            <option value="1e-3">mV</option>
            <option value="1" selected>V</option>
            <option value="1e3">kV</option>
        </select>
    </div>

    <div style="flex-grow:1"></div>
    
    <button id="resetBtn">Reset View</button>
</div>

<div class="canvas-container" id="container">
    <canvas id="canvas"></canvas>
</div>

<div id="context-menu">
    <div class="menu-item" id="menu-add">Add Point Here</div>
    <div class="menu-item" id="menu-snap">Snap to Grid</div>
    <div class="menu-item" id="menu-delete">Delete Point</div>
    <div class="menu-separator"></div>
    
    <div class="menu-item has-submenu">
        Generate <span class="arrow">â–¶</span>
        <div class="submenu">
            <div class="menu-item" id="gen-square">Square Wave</div>
            <div class="menu-item" id="gen-tri">Triangle Wave</div>
            <div class="menu-item" id="gen-saw">Sawtooth Wave</div>
        </div>
    </div>
</div>

<div id="modal-overlay">
    <div class="modal">
        <h3 id="modal-title">Generate Wave</h3>
        <div class="form-row">
            <label>V High (v) <i class="info-icon" data-tooltip="The maximum peak voltage.">i</i></label>
            <input type="number" id="gen-vhigh" value="3.3">
        </div>
        <div class="form-row">
            <label>V Low (v) <i class="info-icon" data-tooltip="The minimum valley voltage.">i</i></label>
            <input type="number" id="gen-vlow" value="0">
        </div>
        <div class="form-row">
            <label>Period (ns) <i class="info-icon" data-tooltip="Duration of one cycle. Updates Frequency.">i</i></label>
            <input type="number" id="gen-period" value="20">
        </div>
        <div class="form-row">
            <label>Freq (MHz) <i class="info-icon" data-tooltip="Cycles per second. Updates Period.">i</i></label>
            <input type="number" id="gen-freq" value="50">
        </div>
        <div class="form-row" id="row-duty">
            <label>Duty Cycle (%) <i class="info-icon" data-tooltip="% of period before falling edge starts.">i</i></label>
            <input type="number" id="gen-duty" value="50">
        </div>
        <div class="form-row" id="row-tr">
            <label>Time Rise (ns) <i class="info-icon" data-tooltip="Time to transition from Low to High.">i</i></label>
            <input type="number" id="gen-tr" value="0.1" step="0.1">
        </div>
        <div class="form-row" id="row-tf">
            <label>Time Fall (ns) <i class="info-icon" data-tooltip="Time to transition from High to Low.">i</i></label>
            <input type="number" id="gen-tf" value="0.1" step="0.1">
        </div>
        <div class="form-row">
            <label>Cycles <i class="info-icon" data-tooltip="Number of repetitions.">i</i></label>
            <input type="number" id="gen-cycles" value="5">
        </div>
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closeGenerator()">Cancel</button>
            <button onclick="generateConfirmed()">Generate</button>
        </div>
    </div>
</div>

<div class="footer">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <span style="font-size:11px; opacity:0.7">Left Drag: Move | Right Click: Menu</span>
        
        <button id="copyBtn" class="icon-btn" title="Copy to Clipboard">
            <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                <path d="M4 4l1-1h5.414L14 6.586V14l-1 1H5l-1-1V4zm9 3l-3-3H5v10h8V7z"/>
                <path d="M3 1L2 2v10l1 1V2h6.414l-1-1H3z"/>
            </svg>
        </button>
    </div>
    <div class="output-box" id="codeOutput">...</div>
</div>

<script src="{{scriptUri}}"></script>
</body>
</html>